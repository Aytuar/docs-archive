# Set up Code Manager for existing PE 2016.1 installations
<p>Set up and deploy Code Manager in three steps:</p>
<ul>
<li>Prepare</li>
<li>Configure Code Manager in the node classifier</li>
<li>Deploy your code</li>
</ul>
<p><strong>Note:</strong> These instructions are for existing installations only.</p>
<h3 id="version-and-installation-information">Version and installation information</h3>
<p><strong>PE version:</strong> 2016.1Â <strong><br>Installation type:</strong> Monolithic, split</p>
<h3 id="solution">Solution</h3>
<h4 id="step-one-prepare">Step One: Prepare</h4>
<p>Before enabling Code Manager, ensure all of the following is in place:</p>
<ul>
<li>
<p>A Git repo. Git hosting services are available from GitLab, GitHub, and other providers.</p>
</li>
<li>
<p>Public and private RSA keys. If you do not have RSA keys, generate them using instructions from <a href="https://docs.gitlab.com/ee/ssh/index.html">GitLab</a> or <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">GitHub</a>.</p>
<p><strong>Note</strong>: We cannot troubleshoot third-party instructions. If you have issues generating SSH keys from the linked instructions, get help from <a href="https://support.github.com/contact">GitHub</a> or <a href="https://about.gitlab.com/get-help/">GitLab</a>.</p>
<ul>
<li>Your public key must be located on your coding machine and the repo.</li>
<li>Your private key must be located on the PE master and the repo. Note the filepath of your private key to configure Code Manager in Step Two.</li>
</ul>
</li>
<li>
<p>A local or external directory <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/code_mgr_config.md#create-a-deployment-role-and-user">deployment user and user role</a>.</p>
<ul>
<li>
<p>Generate a token for the deployment user using the RBAC API or the Puppet Access command line tool. By default, the token's lifetime is set to five minutes. You might want to set a longer lifetime using the <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/rbac_token_auth.md">lifetime option</a>.</p>
</li>
<li>
<p>The <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/rbac_token_auth.md#generating-a-token-using-the-api-endpoint">RBAC API</a> requires using API calls. However, it is built into PE and doesn't require installing any additional packages.</p>
</li>
<li>
<p>The <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/rbac_token_auth.md#generating-a-token-using-the-api-endpoint">Puppet Access tool</a> is easier to use than the RBAC API, but requires <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/install_pe_client_tools.md">downloading and installing a package</a>.</p>
</li>
</ul>
</li>
</ul>
<h4 id="step-two-configure-code-manager-in-the-node-classifier">Step Two: Configure Code Manager in the node classifier</h4>
<ol style="list-style-type: decimal;">
<li>
<p>Log into the console.</p>
</li>
<li>
<p>Navigate to <strong>Nodes &gt; Classification</strong>. Click the <strong>PE Master</strong> node group. Click the <strong>Classes</strong> tab.</p>
</li>
<li>
<p>Under the <code>puppet_enterprise::profile::master</code> class set the following values:</p>
<ul>
<li>r10k_remote = &lt;The SSH URL of your Git repo&gt;</li>
</ul>
<p><strong>Note:</strong> We recommend using the SSH URL of your repo for security reasons, although you can also use the HTTPS URL.</p>
<ul>
<li>code_manager_auto_configure = true</li>
<li>r10k_private_key = &lt;path to the RSA private key on your PE master&gt;</li>
</ul>
</li>
<li>
<p>Click <strong>Add parameter</strong>. Click <strong>Commit changes</strong>.</p>
</li>
<li>
<p>As root on the master, apply your changes by running <code>puppet agent -t</code>.</p>
<p><strong>Critical</strong>: If <code>puppet agent -t</code> returns errors, do not proceed, please contact support for assistance.</p>
</li>
</ol>
<h4 id="step-three-deploy-code">Step Three: Deploy code</h4>
<ol>
<li>
<p>Manually deploy code using the <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/code_mgr_cli.md#deploying-environments-with-puppet-code">CLI for Code Manager</a>.</p>
<ul>
<li>
<strong>For a single environment:</strong> <code>puppet-code deploy &lt;environment&gt; --wait</code>.</li>
<li>
<strong>For all environments:</strong> <code>puppet-code deploy --all --wait</code>.</li>
</ul>
<p>Adding the <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/code_mgr_scripts.md#the-environments-key-with-a-wait"><code>--wait</code> option</a> returns a signature when your environments deploy that includes:</p>
</li>
</ol><ul>
<li>
<p>The SHA generated by your Git repo.</p>
</li>
<li>
<p>Two SHAs generated by PE when:</p>
<ul>
<li>Code Manager moves your code from your control-repo to <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/code_mgr.md#understanding-file-sync-and-the-staging-directory">code staging</a>.</li>
<li>File sync moves your code from Puppet Enterprise's internal Git repo to the <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/code_mgr_scripts.md#the-environments-key-with-a-wait">code directory</a> on each master, master of masters, and compile master.</li>
</ul>
<p>For example:</p>
<pre><code>        [
          {
            "deploy-signature":"482f8d3adc76b5197306c5d4c8aa32aa8315694b",
            "file-sync":{
              "environment-commit":"6939889b679fdb1449545c44f26aa06174d25c21",
              "code-commit":"ce5f7158615759151f77391c7b2b8b497aaebce1"},
            "environment":"production",
            "id":3,
            "status":"complete"
          }
        ]</code></pre>
</li>
</ul>
<li>Automate code deployment by <a href="https://github.com/puppetlabs/docs-archive/blob/main/pe/2016.1/code_mgr_webhook.md">adding a webhook</a>.</li>
